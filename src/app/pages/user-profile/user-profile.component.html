<div class="user-profile-background"></div>
<div class="profile-container">
  <!-- CARD PROFIL -->
  <div class="card">
    <h2>Profil utilizator</h2>
    
    <img [src]="profilePicUrl" alt="Profile Picture" class="profile-pic clickable" />
    <p><strong>First Name:</strong> {{ firstName }}</p>
    <p><strong>Last Name:</strong> {{ lastName }}</p>
    <p><strong>Username:</strong> {{ username }}</p>
    <p><strong>Email:</strong> {{ email }}</p>
    <p><strong>Registered on:</strong> {{ createdAt | date: 'longDate' }}</p>

    <button (click)="openEditModal()">EditeazÄƒ profil</button>
  </div>

  <!-- CARD LECÈšII -->
  <div class="card">
    <h3>LecÈ›ii completate</h3>
    <p class="test-info">
      Vrei sÄƒ generezi un test cu lecÈ›iile pe care nu le stÄƒpÃ¢neÈ™ti atÃ¢t de bine?
      <br />
      Click pe butonul de mai jos!
    </p>

    <!-- Butoane acÈ›iune -->
    <div class="button-group">
      <button *ngIf="!selectMode" (click)="selectLessonsForTest()" class="test-button">
        SelecteazÄƒ lecÈ›ii pentru test
      </button>
      <div *ngIf="selectMode" class="test-action-buttons">
        <button (click)="generateTest()" class="test-button confirm">GenereazÄƒ test</button>
        <button class="test-button cancel">RenunÈ›Äƒ</button>
      </div>
    </div>

    <!-- Scroll lecÈ›ii -->
    <div class="card-lessons-scroll">
      <div *ngFor="let level of ['beginner', 'intermediate', 'advanced']">
        <h4>{{ level | titlecase }} Level</h4>
        <ng-container *ngIf="completedLessonsByLevel[level] as lessons">
          <ul *ngIf="lessons.length > 0; else none">
            <li *ngFor="let lesson of lessons"
                [ngClass]="{
                  'clickable-lesson': selectMode,
                  'selected': selectedLessons.has(lesson._id)
                }"
                (click)="toggleLessonSelection(lesson._id)">
              {{ lesson.title }}
            </li>
          </ul>
        </ng-container>
        <ng-template #none>
          <p><em>No completed lessons yet.</em></p>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" *ngIf="showModal">
  <div class="modal">
    <h3>Editare Profil</h3>
    <img [src]="tempProfilePic || profilePicUrl" alt="Preview" class="profile-pic-preview" />

    <div class="modal-buttons">
      <button (click)="triggerFileInput()">Change Profile Picture</button>
      <button (click)="removeProfilePicture()">Remove Profile Picture</button>
    </div>

    <input type="file" id="fileInput" accept="image/*" (change)="onFileSelected($event)" hidden />

    <label>Prenume:</label>
    <input type="text" [(ngModel)]="tempFirstName" />

    <label>Nume:</label>
    <input type="text" [(ngModel)]="tempLastName" />

    <label>Username:</label>
    <input type="text" [(ngModel)]="tempUsername" (blur)="checkUsernameAvailability()" />
    <div class="error" *ngIf="usernameError">{{ usernameError }}</div>

    <label for="theme-modal-select"><strong>Tema aplicaÈ›iei:</strong></label>
    <select id="theme-modal-select" [(ngModel)]="tempTheme" (ngModelChange)="applyTempTheme()">
      <option value="theme-light">ğŸŒ¸ Paris Breeze</option>
      <option value="theme-warm">ğŸ‘ Peach Fluff</option>
      <option value="theme-earth">ğŸ« Dark Chocolate</option>  
      <option value="theme-dark">ğŸŒ™ Midnight Moon</option>
    </select>
    

    <div class="modal-buttons">
      <button (click)="saveChanges()">Save Changes</button>
      <button (click)="closeModal()">Cancel</button>
    </div>
  </div>
</div>
